# Contract Template 

## T·∫°o d·ª± √°n ink! Flipper 

S·ª≠ d·ª•ng pop cli 

```bash
pop new contract flipper
```

Sau khi t·∫°o contract xong:
```
flipper
  ‚îî‚îÄ lib.rs                <-- Contract Source Code
  ‚îî‚îÄ Cargo.toml            <-- Rust Dependencies and ink! Configuration
  ‚îî‚îÄ .gitignore
```

## Ph√¢n t√≠ch code c∆° b·∫£n 

### Cargo.toml

<details>
  <summary>Code</summary>
    ```rust
    [package]
    name = "flipper"
    version = "0.1.0"
    authors = ["[your_name] <[your_email]>"]
    edition = "2021"
    // import th∆∞ vi·ªán ink 
    [dependencies]
    ink = { version = "5.0.0", default-features = false }

    // H·ªó tr·ª£ e2e testing 
    [dev-dependencies]
    ink_e2e = { version = "5.0.0" }
    // Thay v√¨ ch·∫°y file main.rs th√¨ ch·∫°y file lib.rs
    [lib]
    path = "lib.rs"
    // T∆∞∆°ng t·ª± nh∆∞ pallet 
    [features]
    default = ["std"]
    std = [
        "ink/std",
    ]
    ink-as-dependency = []
    e2e-tests = []
    ```
</details>


### lib.rs
G·ªìm 3 ch·ª©c nƒÉng ch√≠nh 

1. ƒê·ªãnh nghƒ©a h√†m kh·ªüi t·∫°o khi deploy contract (h·ªó tr·ª£ multiple constructor)

S·ª≠ d·ª•ng h√†m `new` 
```rust
    #[ink(constructor)]
    pub fn new(init_value: bool) -> Self {
        Self { value: init_value }
    }
```

S·ª≠ d·ª•ng h√†m `default` 
```rust
    #[ink(constructor)]
    pub fn default() -> Self {
        Self::new(Default::default())
    }
```

1. Chuy·ªÉn ƒë·ªïi tr·∫°ng th√°i `true` sang `false` v√† ng∆∞·ª£c l·∫°i 

```rust
    #[ink(message)]
    pub fn flip(&mut self) {
        self.value = !self.value;
    }
```
2. L·∫•y th√¥ng tin tr·∫°ng th√°i hi·ªán t·∫°i 

```rust
    #[ink(message)]
    pub fn get(&self) -> bool {
        self.value
    }
```

## T∆∞∆°ng t·ª± code Rust 

```rust
pub struct Flipper {
    value: bool
}

impl Flipper {
    pub fn init(init_value: bool) -> Self {
        Self { value: init_value }
    }

    pub fn default() -> Self {
        Self::init(Default::default())
    }

    pub fn flip(&mut self) {
        self.value = !self.value;
    }

    pub fn get(&self) -> bool {
        self.value
    }
}
```

## Ch·∫°y unit test


```rust
    #[cfg(test)]
    mod tests {
        /// Imports all the definitions from the outer scope so we can use them here.
        use super::*;

        /// We test if the default constructor does its job.
        #[ink::test]
        fn default_works() {
            let flipper = Flipper::default();
            assert_eq!(flipper.get(), false);
        }

        /// We test a simple use case of our contract.
        #[ink::test]
        fn it_works() {
            let mut flipper = Flipper::new(false);
            assert_eq!(flipper.get(), false);
            flipper.flip();
            assert_eq!(flipper.get(), true);
        }
    }
```

S·ª≠ d·ª•ng command ƒë·ªÉ ch·∫°y test:

```bash
pop test contract 
```


## Ch·∫°y e2e test

```bash
cargo test --features e2e-tests
```

## T∆∞∆°ng t√°c contract 

### RPC endpoint 
POP NETWORK TESTNET: `wss://rpc1.paseo.popnetwork.xyz`

ALEPH ZERO TESTNET: `wss://ws.test.azero.dev`

### Faucet 
Faucet Polkadot Testnet: https://faucet.polkadot.io/

Faucet POP Network Testnet: https://onboard.popnetwork.xyz/

Faucet Aleph Zero: https://faucet.test.azero.dev/


### Build contract

```bash
pop build 
```

K·∫øt qu·∫£ sau khi build:

```rust
‚îÇ  
‚îÇ    - flipper.contract (code + metadata)
‚îÇ    - flipper.wasm (the contract's code)
‚îÇ    - flipper.json (the contract's metadata)
```

### S·ª≠ d·ª•ng ink! CLI (Aleph Zero Testnet) 

#### Step 1: Deploy the contract (Instantiate) 

```bash
cargo contract instantiate --constructor new --args true -s "//Alice" --url wss://ws.test.azero.dev -x
```

<details>
  <summary>K·∫øt qu·∫£ </summary>
```rust
 Dry-running new (skip with --skip-dry-run)
    Success! Gas required estimated at Weight(ref_time: 147322009, proof_size: 16689)
Confirm transaction details: (skip with --skip-confirm or -y)
 Constructor new
        Args true
   Gas limit Weight(ref_time: 147322009, proof_size: 16689)
Submit? (Y/n): y
      Events
       Event Balances ‚ûú Withdraw
         who: 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY
         amount: 334.800097ŒºTZERO
       Event Contracts ‚ûú CodeStored
         code_hash: 0xc9a3371d9272feba4faa0045a08bc6adc8b61c4a68d279a595ccd150aaa9bea9
         deposit_held: 426.04mTZERO
         uploader: 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY
       Event System ‚ûú NewAccount
         account: 5FVK4afyN6p6NSfzEzvcCx9KsDgAfc95RSDHT4TJP7wj6NpV
       Event Balances ‚ûú Endowed
         account: 5FVK4afyN6p6NSfzEzvcCx9KsDgAfc95RSDHT4TJP7wj6NpV
         free_balance: 0.50nTZERO
       Event Balances ‚ûú Transfer
         from: 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY
         to: 5FVK4afyN6p6NSfzEzvcCx9KsDgAfc95RSDHT4TJP7wj6NpV
         amount: 0.50nTZERO
       Event Contracts ‚ûú Instantiated
         deployer: 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY
         contract: 5FVK4afyN6p6NSfzEzvcCx9KsDgAfc95RSDHT4TJP7wj6NpV
       Event Contracts ‚ûú StorageDepositTransferredAndHeld
         from: 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY
         to: 5FVK4afyN6p6NSfzEzvcCx9KsDgAfc95RSDHT4TJP7wj6NpV
         amount: 133.972mTZERO
       Event Contracts ‚ûú StorageDepositTransferredAndHeld
         from: 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY
         to: 5FVK4afyN6p6NSfzEzvcCx9KsDgAfc95RSDHT4TJP7wj6NpV
         amount: 1.32mTZERO
       Event Balances ‚ûú Deposit
         who: 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY
         amount: 824.914nTZERO
       Event Balances ‚ûú Deposit
         who: 5EYCAe5fg5WiYGVNH6QpCFnu55Hzv9MwtjFHdQCx8EaSQTm2
         amount: 333.975183ŒºTZERO
       Event Treasury ‚ûú Deposit
         value: 333975183
       Event TransactionPayment ‚ûú TransactionFeePaid
         who: 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY
         actual_fee: 333.975183ŒºTZERO
         tip: 0TZERO
       Event System ‚ûú ExtrinsicSuccess
         dispatch_info: DispatchInfo { weight: Weight { ref_time: 3339741184, proof_size: 9097 }, class: Normal, pays_fee: Yes }

   Code hash 0xc9a3371d9272feba4faa0045a08bc6adc8b61c4a68d279a595ccd150aaa9bea9
    Contract 5FVK4afyN6p6NSfzEzvcCx9KsDgAfc95RSDHT4TJP7wj6NpV
```
</details>



```bash
Code hash 0xc9a3371d9272feba4faa0045a08bc6adc8b61c4a68d279a595ccd150aaa9bea9
Contract 5FVK4afyN6p6NSfzEzvcCx9KsDgAfc95RSDHT4TJP7wj6NpV
```

#### Step 2: Get value 

```bash
cargo contract call --contract 5FVK4afyN6p6NSfzEzvcCx9KsDgAfc95RSDHT4TJP7wj6NpV --message get --suri "//Alice" --url wss://ws.test.azero.dev
```

K·∫øt qu·∫£:
```rust
      Result Ok(true)
    Reverted false
Your message call has not been executed.
```

#### Step 3: Flip message

```bash
cargo contract call --contract 5FVK4afyN6p6NSfzEzvcCx9KsDgAfc95RSDHT4TJP7wj6NpV --message flip --suri "//Alice" --url wss://ws.test.azero.dev -x
```

### S·ª≠ d·ª•ng POP CLI (Aleph Zero Testnet) 
#### Step 1: Deploy the contract

```bash
pop up contract --constructor new --args false --suri //Alice --url wss://ws.test.azero.dev
```

K·∫øt qu·∫£:
```rust
‚îå   Pop CLI : Deploy a smart contract
‚îÇ
‚óá  Gas limit estimate: Weight { ref_time: 147322009, proof_size: 16689 }
‚îÇ
‚óá  Contract deployed and instantiated: The Contract Address is "5FKuCodrM86MRLuNLhgjRXGFpZ5h9UFuTgtm1a97pwm5qdyo"
‚îÇ
‚îî  üöÄ Deployment complete
```

#### Step 2: Get value 

```bash
pop call contract --contract 5FKuCodrM86MRLuNLhgjRXGFpZ5h9UFuTgtm1a97pwm5qdyo --message get --url wss://ws.test.azero.dev --dry-run
```

K·∫øt qu·∫£:
```rust
‚îå   Pop CLI : Calling a contract
‚îÇ
‚óí  Doing a dry run to estimate the gas...                                                                 ‚öô  Gas limit: Weight { ref_time: 471840652, proof_size: 27219 }
‚îÇ  
‚ñ≤  Your call has not been executed.
```

#### Step 3: Flip message

```bash
pop call contract --contract 5FKuCodrM86MRLuNLhgjRXGFpZ5h9UFuTgtm1a97pwm5qdyo --message flip --url wss://ws.test.azero.dev -x
```

<details>
  <summary>K·∫øt qu·∫£ </summary>
```rust
‚îÇ
‚óì  Doing a dry run to estimate the gas...                                                                 ‚öô  Gas limit: Weight { ref_time: 600499779, proof_size: 27513 }
‚îÇ  
‚óê  Calling the contract...                                                                                ‚öô        Events
‚îÇ         Event Balances ‚ûú Withdraw
‚îÇ           who: 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY
‚îÇ           amount: 153.815292ŒºTZERO
‚îÇ         Event Contracts ‚ûú Called
‚îÇ           caller: Signed(5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY)
‚îÇ           contract: 5FKuCodrM86MRLuNLhgjRXGFpZ5h9UFuTgtm1a97pwm5qdyo
‚îÇ         Event Balances ‚ûú Deposit
‚îÇ           who: 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY
‚îÇ           amount: 859.218nTZERO
‚îÇ         Event Balances ‚ûú Deposit
‚îÇ           who: 5EYCAe5fg5WiYGVNH6QpCFnu55Hzv9MwtjFHdQCx8EaSQTm2
‚îÇ           amount: 152.956074ŒºTZERO
‚îÇ         Event Treasury ‚ûú Deposit
‚îÇ           value: 152956074
‚îÇ         Event TransactionPayment ‚ûú TransactionFeePaid
‚îÇ           who: 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY
‚îÇ           actual_fee: 152.956074ŒºTZERO
‚îÇ           tip: 0TZERO
‚îÇ         Event System ‚ûú ExtrinsicSuccess
‚îÇ           dispatch_info: DispatchInfo { weight: Weight { ref_time: 1529560592, proof_size: 17941 }, class: Normal, pays_fee: Yes }
‚îÇ  
‚îî  Call completed successfully!
```
</details>


### S·ª≠ d·ª•ng Contract UI deploy tr√™n POP Network testnet 

Link t∆∞∆°ng t√°c contract UI: https://ui.use.ink/

#### Step 1: Upload contract 


![](../assets/upload_contract.png)

#### Step 2: Upload Code 
+ Ch·ªçn `Account` mu·ªën deploy contract ( deployer)
+ T√™n contract
+ Import file `.contract` sau khi ƒë√£ build ( `./target/ink`)

![](../assets/upload_code.png)


#### Step 3: Instantiate the contract (deploy contract) 


![](../assets/deploy_ink_code.png)


#### Step 4: T∆∞∆°ng t√°c h√†m `flip` 

![](../assets/call_flip.png)


#### Step 5: T∆∞∆°ng t√°c h√†m `get`

![](../assets/call_get.png)